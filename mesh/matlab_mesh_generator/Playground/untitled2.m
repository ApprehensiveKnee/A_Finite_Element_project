
mn=npdx*npdy;
B_sub_cell_x=sparse(mn,mn);B_sub_cell_x=0;
B_sub_cell_y=sparse(mn,mn);B_sub_cell_y=0;
for ki=1:npdy
    inde=((ki-1)*npdx+1:ki*npdx);
    B_sub_cell_x(inde,inde)=dx;
end
for i=1:npdx
    inde=(i:npdx:mn);
    B_sub_cell_y(inde,inde)=dy;
end


%%

clc;
close all;
clear all;

DIM = 2;
nq = 9;

Bval = zeros(DIM*nq, nq);
for i=2:DIM*nq+1
    Bval(i-1,fix(i/2))= 1;
end

D = zeros(DIM*nq, DIM*nq);
for i= 2:nq*DIM+1
    D(i-1,i-1)= 1;
end


result =Bval'*D*Bval;

%%
clear all,
close all;
x = 1:21;
y = x;
[X,Y] = meshgrid(x,y);
Z = [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
32.6559 31.0456 26.4192 19.1873 10.0912 0 -10.0912 -19.1873 -26.4192 -31.0456 -32.6559 -31.0456 -26.4192 -19.1873 -10.0912 0 10.0912 19.1873 26.4192 31.0456 32.6559 
52.4799 49.8921 42.4571 30.835 16.2172 -2.9976e-14 -16.2172 -30.835 -42.4571 -49.8921 -52.4799 -49.8921 -42.4571 -30.835 -16.2172 -3.9968e-14 16.2172 30.835 42.4571 49.8921 52.4799 
52.8384 50.2329 42.7472 31.0456 16.328 -3.9968e-14 -16.328 -31.0456 -42.7472 -50.2329 -52.8384 -50.2329 -42.7472 -31.0456 -16.328 -2.9976e-14 16.328 31.0456 42.7472 50.2329 52.8384 
32.4344 30.835 26.24 19.0571 10.0228 -9.99201e-15 -10.0228 -19.0571 -26.24 -30.835 -32.4344 -30.835 -26.24 -19.0571 -10.0228 -1.9984e-14 10.0228 19.0571 26.24 30.835 32.4344 
6.1414e-15 5.34971e-15 7.51117e-15 6.20152e-15 3.6604e-16 -4.68305e-15 -8.39166e-15 -5.1437e-15 -8.21188e-16 -1.65223e-15 -5.40604e-15 -7.38296e-15 -5.72076e-15 1.60131e-16 4.7325e-16 -6.85473e-15 -4.65799e-15 5.54485e-15 9.49317e-15 8.46047e-15 8.1666e-15 
-32.4344 -30.835 -26.24 -19.0571 -10.0228 0 10.0228 19.0571 26.24 30.835 32.4344 30.835 26.24 19.0571 10.0228 0 -10.0228 -19.0571 -26.24 -30.835 -32.4344 
-52.8384 -50.2329 -42.7472 -31.0456 -16.328 -1.9984e-14 16.328 31.0456 42.7472 50.2329 52.8384 50.2329 42.7472 31.0456 16.328 0 -16.328 -31.0456 -42.7472 -50.2329 -52.8384 
-52.4799 -49.8921 -42.4571 -30.835 -16.2172 -9.99201e-15 16.2172 30.835 42.4571 49.8921 52.4799 49.8921 42.4571 30.835 16.2172 0 -16.2172 -30.835 -42.4571 -49.8921 -52.4799 
-32.6559 -31.0456 -26.4192 -19.1873 -10.0912 0 10.0912 19.1873 26.4192 31.0456 32.6559 31.0456 26.4192 19.1873 10.0912 1.9984e-14 -10.0912 -19.1873 -26.4192 -31.0456 -32.6559 
1.20386e-14 1.06576e-14 9.89244e-15 5.42318e-15 -2.93786e-15 -8.90989e-15 -1.57959e-14 -1.35094e-14 -2.93555e-15 1.52404e-15 -5.60682e-16 -3.48444e-15 -4.96658e-15 -3.31229e-15 8.1045e-16 -3.41315e-15 -6.91818e-15 5.36844e-15 1.29395e-14 9.65585e-15 8.90625e-15 
32.6559 31.0456 26.4192 19.1873 10.0912 0 -10.0912 -19.1873 -26.4192 -31.0456 -32.6559 -31.0456 -26.4192 -19.1873 -10.0912 -9.99201e-15 10.0912 19.1873 26.4192 31.0456 32.6559 
52.4799 49.8921 42.4571 30.835 16.2172 0 -16.2172 -30.835 -42.4571 -49.8921 -52.4799 -49.8921 -42.4571 -30.835 -16.2172 0 16.2172 30.835 42.4571 49.8921 52.4799 
52.8384 50.2329 42.7472 31.0456 16.328 0 -16.328 -31.0456 -42.7472 -50.2329 -52.8384 -50.2329 -42.7472 -31.0456 -16.328 -1.9984e-14 16.328 31.0456 42.7472 50.2329 52.8384 
32.4344 30.835 26.24 19.0571 10.0228 -9.99201e-15 -10.0228 -19.0571 -26.24 -30.835 -32.4344 -30.835 -26.24 -19.0571 -10.0228 9.99201e-15 10.0228 19.0571 26.24 30.835 32.4344 
6.41214e-15 5.89415e-15 4.13237e-15 1.00414e-14 1.65185e-14 7.64541e-15 -5.85791e-15 -1.32248e-14 -1.3445e-14 -1.04817e-14 -8.49285e-15 -6.52885e-15 -3.7923e-15 -4.17097e-15 -6.66759e-15 -2.73296e-15 1.75252e-15 3.37709e-15 6.90473e-15 1.01811e-14 1.14829e-14 
-32.4344 -30.835 -26.24 -19.0571 -10.0228 0 10.0228 19.0571 26.24 30.835 32.4344 30.835 26.24 19.0571 10.0228 0 -10.0228 -19.0571 -26.24 -30.835 -32.4344 
-52.8384 -50.2329 -42.7472 -31.0456 -16.328 9.99201e-15 16.328 31.0456 42.7472 50.2329 52.8384 50.2329 42.7472 31.0456 16.328 -1.9984e-14 -16.328 -31.0456 -42.7472 -50.2329 -52.8384 
-52.4799 -49.8921 -42.4571 -30.835 -16.2172 3.9968e-14 16.2172 30.835 42.4571 49.8921 52.4799 49.8921 42.4571 30.835 16.2172 -9.99201e-15 -16.2172 -30.835 -42.4571 -49.8921 -52.4799 
-32.6559 -31.0456 -26.4192 -19.1873 -10.0912 9.99201e-15 10.0912 19.1873 26.4192 31.0456 32.6559 31.0456 26.4192 19.1873 10.0912 0 -10.0912 -19.1873 -26.4192 -31.0456 -32.6559 
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0  ];
figure;
surf(X,Y,Z)

G = [0 0 0 0 0 0 -0 -0 -0 -0 -0 -0 -0 -0 -0 -0 0 0 0 0 0 
3.69316 3.51241 2.98783 2.17079 1.14125 2.26141e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -6.78423e-16 1.14125 2.17079 2.98783 3.51241 3.69316 
5.97566 5.68319 4.83441 3.51241 1.84658 3.65904e-16 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -1.09771e-15 1.84658 3.51241 4.83441 5.68319 5.97566 
5.97566 5.68319 4.83441 3.51241 1.84658 3.65904e-16 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -1.09771e-15 1.84658 3.51241 4.83441 5.68319 5.97566 
3.69316 3.51241 2.98783 2.17079 1.14125 2.26141e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -6.78423e-16 1.14125 2.17079 2.98783 3.51241 3.69316 
7.69468e-16 7.31808e-16 6.22513e-16 4.52282e-16 2.37779e-16 4.71163e-32 -2.37779e-16 -4.52282e-16 -6.22513e-16 -7.31808e-16 -7.69468e-16 -7.31808e-16 -6.22513e-16 -4.52282e-16 -2.37779e-16 -1.41349e-31 2.37779e-16 4.52282e-16 6.22513e-16 7.31808e-16 7.69468e-16 
-3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -2.26141e-16 1.14125 2.17079 2.98783 3.51241 3.69316 3.51241 2.98783 2.17079 1.14125 6.78423e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 
-5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -3.65904e-16 1.84658 3.51241 4.83441 5.68319 5.97566 5.68319 4.83441 3.51241 1.84658 1.09771e-15 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 
-5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -3.65904e-16 1.84658 3.51241 4.83441 5.68319 5.97566 5.68319 4.83441 3.51241 1.84658 1.09771e-15 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 
-3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -2.26141e-16 1.14125 2.17079 2.98783 3.51241 3.69316 3.51241 2.98783 2.17079 1.14125 6.78423e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 
-1.53894e-15 -1.46362e-15 -1.24503e-15 -9.04564e-16 -4.75558e-16 -9.42327e-32 4.75558e-16 9.04564e-16 1.24503e-15 1.46362e-15 1.53894e-15 1.46362e-15 1.24503e-15 9.04564e-16 4.75558e-16 2.82698e-31 -4.75558e-16 -9.04564e-16 -1.24503e-15 -1.46362e-15 -1.53894e-15 
3.69316 3.51241 2.98783 2.17079 1.14125 2.26141e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -6.78423e-16 1.14125 2.17079 2.98783 3.51241 3.69316 
5.97566 5.68319 4.83441 3.51241 1.84658 3.65904e-16 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -1.09771e-15 1.84658 3.51241 4.83441 5.68319 5.97566 
5.97566 5.68319 4.83441 3.51241 1.84658 3.65904e-16 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -1.09771e-15 1.84658 3.51241 4.83441 5.68319 5.97566 
3.69316 3.51241 2.98783 2.17079 1.14125 2.26141e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -6.78423e-16 1.14125 2.17079 2.98783 3.51241 3.69316 
2.3084e-15 2.19542e-15 1.86754e-15 1.35685e-15 7.13336e-16 1.41349e-31 -7.13336e-16 -1.35685e-15 -1.86754e-15 -2.19542e-15 -2.3084e-15 -2.19542e-15 -1.86754e-15 -1.35685e-15 -7.13336e-16 -4.24047e-31 7.13336e-16 1.35685e-15 1.86754e-15 2.19542e-15 2.3084e-15 
-3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -2.26141e-16 1.14125 2.17079 2.98783 3.51241 3.69316 3.51241 2.98783 2.17079 1.14125 6.78423e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 
-5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -3.65904e-16 1.84658 3.51241 4.83441 5.68319 5.97566 5.68319 4.83441 3.51241 1.84658 1.09771e-15 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 
-5.97566 -5.68319 -4.83441 -3.51241 -1.84658 -3.65904e-16 1.84658 3.51241 4.83441 5.68319 5.97566 5.68319 4.83441 3.51241 1.84658 1.09771e-15 -1.84658 -3.51241 -4.83441 -5.68319 -5.97566 
-3.69316 -3.51241 -2.98783 -2.17079 -1.14125 -2.26141e-16 1.14125 2.17079 2.98783 3.51241 3.69316 3.51241 2.98783 2.17079 1.14125 6.78423e-16 -1.14125 -2.17079 -2.98783 -3.51241 -3.69316 
-3.07787e-15 -2.92723e-15 -2.49005e-15 -1.80913e-15 -9.51115e-16 -1.88465e-31 9.51115e-16 1.80913e-15 2.49005e-15 2.92723e-15 3.07787e-15 2.92723e-15 2.49005e-15 1.80913e-15 9.51115e-16 5.65396e-31 -9.51115e-16 -1.80913e-15 -2.49005e-15 -2.92723e-15 -3.07787e-15 ]

figure;
surf(X,Y,G)

